---
title: "Xeva Tutorial"
author: "Arvind Mer"
date: "`r Sys.Date()`"
output: pdf_document
vignette: >
  %\VignetteIndexEntry{Introduction to the Xeva R package}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load Xeva
Load Xeva library and data.
```{r load, echo=TRUE}
library(Xeva)
data(lpdx)
head(modelInfo(lpdx))
```

Models which belongs to same batch are in one list which is stored in expDesign slot. For example
```{r, echo=TRUE}
print(batchNames(lpdx)) 
```

To calculate angle between the treatment and control samples of this batch
```{r, echo=TRUE}
batchNames <- batchNames(lpdx)
expDesign  <- expDesign(lpdx, batchNames[4])
ang <- calculateAngle(lpdx, expDesign, treatment.only = TRUE, plot=TRUE)
print(ang)
```

Summarize Response of PDXs
Get slop of each model and combine summarize all model slop which belongs to same patient by "mean"
```{r, echo=TRUE}
lpdx_slop <- summarizeResponse(lpdx, response.measure = "slop", 
                               group.by="patient.id", summary.stat = "mean")


```


Get angle between treatment and control model ids. For each batch it will give one angle value
```{r, echo=TRUE}
lpdx_angle <- summarizeResponse(lpdx, response.measure = "angle")

```

\pagebreak

Create mRECIST plot for PDXE Lung Cancer data
```{r, echo=TRUE, fig.width = 12, fig.height = 10}
data(pdxe)
df <- getmRECIST(pdxe)
## add tumor.type information
dfMap <- mapModelSlotIds(object=pdxe, id=df$model.id, id.name="model.id",
                        map.to="tumor.type", unique = FALSE)
#dfx = merge(df, dfMap, by.x = "model.id", by.y = "model.id")
if(all(df$model.id==dfMap$model.id)) {df$tumor.type = dfMap$tumor.type}
lungDf = df[df$tumor.type=="NSCLC", ]
#pdf(file="DATA-raw/mRECIST_plot_NSCLC.pdf", width=12, height=10)
plotmRECIST(lungDf, groupBy = "biobase.id", control.name = "untreated")
```

<!-- \pagebreak -->
<!-- This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>. -->

<!-- When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this: -->

<!-- ```{r cars} -->
<!-- summary(cars) -->
<!-- ``` -->

<!-- ```{r cars2} -->
<!-- summary(cars) -->
<!-- ``` -->
<!-- ## Including Plots -->

<!-- You can also embed plots, for example: -->

<!-- ```{r pressureX, , include=TRUE, echo=FALSE} -->
<!-- plot(pressure) -->
<!-- ``` -->

<!-- Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot. -->
